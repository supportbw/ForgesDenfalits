<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Actualit√©s & Agenda du Coin ‚Äì Les Forges d'Enfalits</title>
<meta name="description" content="√âv√©nements, march√©s, randonn√©es et activit√©s autour des Forges d'Enfalits en Ari√®ge Pyr√©n√©es.">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=Playfair+Display:ital,wght@0,400;0,500;1,400&family=Dancing+Script:wght@400;600;700&family=Jost:wght@300;400;500&display=swap" rel="stylesheet">
<style>
:root {
  --cream: #f5efe4;
  --cream-dark: #ede4d5;
  --warm-brown: #7c5c3e;
  --gold: #c9a96e;
  --dark: #3a2e22;
  --text: #5a4a35;
  --text-light: #8a7560;
  --white: #fdfaf5;
}
* { margin: 0; padding: 0; box-sizing: border-box; }
html { scroll-behavior: smooth; }
body { background: var(--cream); font-family: 'Jost', sans-serif; color: var(--text); overflow-x: hidden; }
header { position: fixed; top: 0; width: 100%; z-index: 1000; padding: 16px 60px; display: flex; justify-content: space-between; align-items: center; transition: all 0.5s ease; background: transparent; }
header.scrolled { background: rgba(245,239,228,0.96); backdrop-filter: blur(10px); box-shadow: 0 2px 30px rgba(100,70,30,0.08); padding: 10px 60px; }
.logo img { height: 52px; }
nav { display: flex; align-items: center; gap: 10px; }
nav a { font-family: 'Jost', sans-serif; font-size: 0.8rem; font-weight: 400; letter-spacing: 0.12em; text-transform: uppercase; color: white; text-decoration: none; padding: 6px 14px; transition: 0.3s; position: relative; }
header.scrolled nav a { color: var(--text); }
nav a::after { content: ''; position: absolute; bottom: 2px; left: 14px; right: 14px; height: 1px; background: var(--gold); transform: scaleX(0); transition: 0.3s; }
nav a:hover::after { transform: scaleX(1); }
nav a.active { color: rgba(255,255,255,0.75); }
header.scrolled nav a.active { color: var(--warm-brown); }
.nav-cta { background: rgba(124,92,62,0.85) !important; color: white !important; border-radius: 3px; padding: 8px 20px !important; font-size: 0.75rem !important; }
header.scrolled .nav-cta { background: var(--warm-brown) !important; }
.nav-cta::after { display: none !important; }
.nav-cta:hover { background: var(--dark) !important; }
.page-hero { height: 380px; position: relative; overflow: hidden; display: flex; align-items: center; justify-content: center; text-align: center; background: url('forges-d-enfalits-chambres-hotes-parc-1920-12.webp') center/cover no-repeat; }
.page-hero::before { content: ''; position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(20,12,5,0.5), rgba(58,46,34,0.65)); }
.page-hero-content { position: relative; z-index: 1; }
.page-hero-eyebrow { font-family: 'Jost', sans-serif; font-size: 0.72rem; letter-spacing: 0.3em; text-transform: uppercase; color: var(--gold); margin-bottom: 14px; }
.page-hero h1 { font-family: 'Dancing Script', cursive; font-size: clamp(2.8rem, 6vw, 5rem); color: white; font-weight: 600; line-height: 1.1; margin-bottom: 10px; text-shadow: 0 2px 20px rgba(0,0,0,0.3); }
.page-hero p { font-family: 'Cormorant Garamond', serif; font-size: 1.2rem; font-style: italic; color: rgba(255,255,255,0.85); }
.main-content { max-width: 1200px; margin: 0 auto; padding: 60px 40px 100px; }
.filters-bar { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 50px; align-items: center; }
.filter-label { font-family: 'Jost', sans-serif; font-size: 0.7rem; letter-spacing: 0.25em; text-transform: uppercase; color: var(--text-light); margin-right: 6px; }
.filter-btn { font-family: 'Jost', sans-serif; font-size: 0.75rem; letter-spacing: 0.08em; padding: 8px 18px; border-radius: 30px; border: 1px solid var(--cream-dark); background: white; color: var(--text-light); cursor: pointer; transition: 0.3s; }
.filter-btn:hover, .filter-btn.active { background: var(--warm-brown); color: white; border-color: var(--warm-brown); }
.loading-state { text-align: center; padding: 80px 20px; display: none; }
.loading-state.visible { display: block; }
.loading-spinner { width: 50px; height: 50px; border: 3px solid var(--cream-dark); border-top-color: var(--gold); border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
@keyframes spin { to { transform: rotate(360deg); } }
.loading-text { font-family: 'Cormorant Garamond', serif; font-size: 1.2rem; font-style: italic; color: var(--text-light); }
.loading-sub { font-size: 0.82rem; color: var(--text-light); margin-top: 8px; }
.events-header { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 30px; }
.events-count { font-size: 0.82rem; color: var(--text-light); letter-spacing: 0.1em; }
.refresh-btn { font-family: 'Jost', sans-serif; font-size: 0.72rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--warm-brown); background: none; border: none; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: 0.3s; }
.refresh-btn:hover { color: var(--dark); }
.refresh-icon { display: inline-block; transition: transform 0.5s; }
.refresh-btn:hover .refresh-icon { transform: rotate(180deg); }
.events-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 28px; }
.event-card { background: var(--white); border-radius: 6px; overflow: hidden; box-shadow: 0 6px 30px rgba(100,70,30,0.07); transition: 0.4s ease; display: flex; flex-direction: column; }
.event-card:hover { transform: translateY(-6px); box-shadow: 0 16px 45px rgba(100,70,30,0.13); }
.event-card.featured { grid-column: 1 / -1; flex-direction: row; position: relative; }
.event-card-top { padding: 24px 24px 0; display: flex; gap: 16px; align-items: flex-start; }
.event-card.featured .event-card-top { padding: 28px; flex: 1; align-items: center; }
.event-date-box { flex-shrink: 0; width: 54px; text-align: center; background: var(--cream); border-radius: 4px; padding: 8px 6px; }
.event-card.featured .event-date-box { width: 70px; }
.event-date-day { font-family: 'Cormorant Garamond', serif; font-size: 1.8rem; font-weight: 500; color: var(--warm-brown); line-height: 1; }
.event-card.featured .event-date-day { font-size: 2.4rem; }
.event-date-month { font-family: 'Jost', sans-serif; font-size: 0.62rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--text-light); margin-top: 2px; }
.event-meta { flex: 1; }
.event-category { display: inline-block; font-family: 'Jost', sans-serif; font-size: 0.65rem; letter-spacing: 0.2em; text-transform: uppercase; padding: 3px 10px; border-radius: 20px; margin-bottom: 8px; font-weight: 500; }
.cat-fete { background: #fff0e0; color: #b05a00; }
.cat-marche { background: #e8f5e0; color: #4a7a20; }
.cat-nature { background: #e0f0f5; color: #1a6a80; }
.cat-culture { background: #f0e8f5; color: #6a1a80; }
.cat-sport { background: #fff5e0; color: #8a5500; }
.cat-gastronomie { background: #fde8e8; color: #8a1a1a; }
.cat-autre { background: var(--cream-dark); color: var(--text-light); }
.event-title { font-family: 'Playfair Display', serif; font-size: 1.05rem; font-weight: 500; color: var(--dark); line-height: 1.3; margin-bottom: 4px; }
.event-card.featured .event-title { font-size: 1.3rem; }
.event-card-body { padding: 14px 24px 20px; flex: 1; display: flex; flex-direction: column; }
.event-card.featured .event-card-body { padding: 28px; border-left: 1px solid var(--cream-dark); }
.event-location { font-size: 0.8rem; color: var(--text-light); display: flex; align-items: center; gap: 5px; margin-bottom: 10px; }
.event-location::before { content: 'üìç'; font-size: 0.75rem; }
.event-desc { font-size: 0.87rem; line-height: 1.65; color: var(--text); font-weight: 300; flex: 1; }
.event-card-footer { padding: 14px 24px; border-top: 1px solid var(--cream-dark); display: flex; justify-content: space-between; align-items: center; }
.event-card.featured .event-card-footer { flex-direction: column; gap: 12px; justify-content: center; padding: 28px; border-top: none; border-left: 1px solid var(--cream-dark); min-width: 160px; }
.event-distance { font-size: 0.75rem; color: var(--text-light); }
.event-link { font-family: 'Jost', sans-serif; font-size: 0.7rem; letter-spacing: 0.15em; text-transform: uppercase; color: var(--warm-brown); text-decoration: none; display: flex; align-items: center; gap: 4px; transition: 0.3s; }
.event-link:hover { color: var(--dark); gap: 8px; }
.featured-badge { position: absolute; top: 16px; right: 16px; background: var(--gold); color: white; font-family: 'Jost', sans-serif; font-size: 0.62rem; letter-spacing: 0.2em; text-transform: uppercase; padding: 4px 10px; border-radius: 20px; }
.section-links { margin-top: 70px; padding-top: 50px; border-top: 1px solid var(--cream-dark); }
.section-links h2 { font-family: 'Cormorant Garamond', serif; font-size: 1.8rem; font-weight: 400; color: var(--dark); margin-bottom: 8px; }
.section-links .sub { font-size: 0.88rem; color: var(--text-light); margin-bottom: 30px; }
.links-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 16px; }
.link-card { background: var(--white); border-radius: 6px; padding: 20px 22px; display: flex; align-items: center; gap: 14px; text-decoration: none; transition: 0.3s; box-shadow: 0 4px 20px rgba(100,70,30,0.06); }
.link-card:hover { transform: translateY(-3px); box-shadow: 0 10px 30px rgba(100,70,30,0.1); }
.link-icon { font-size: 1.6rem; flex-shrink: 0; }
.link-info h4 { font-family: 'Jost', sans-serif; font-size: 0.82rem; font-weight: 500; color: var(--dark); margin-bottom: 3px; }
.link-info p { font-size: 0.75rem; color: var(--text-light); }
.last-updated { text-align: center; margin-top: 40px; font-size: 0.75rem; color: var(--text-light); letter-spacing: 0.1em; }
footer { background: var(--dark); padding: 35px 10%; color: rgba(255,255,255,0.6); }
.footer-bottom { display: flex; justify-content: space-between; align-items: center; font-size: 0.78rem; flex-wrap: wrap; gap: 12px; }
.footer-back { color: var(--gold); text-decoration: none; }
.footer-back:hover { color: white; }
@media (max-width: 768px) {
  header { padding: 12px 20px; }
  nav { display: none; }
  .main-content { padding: 50px 20px 80px; }
  .event-card.featured { flex-direction: column; }
  .event-card.featured .event-card-footer { flex-direction: row; border-left: none; border-top: 1px solid var(--cream-dark); min-width: auto; }
  .events-grid { grid-template-columns: 1fr; }
}
</style>
</head>
<body>

<header id="header">
  <div class="logo"><img src="logo-forges-denfalits.png" alt="Les Forges d'Enfalits"></div>
  <nav>
    <a href="index.html">Accueil</a>
    <a href="index.html#hebergements">H√©bergements</a>
    <a href="index.html#bien-etre">Bien-√ätre</a>
    <a href="index.html#nature">Nature</a>
    <a href="index.html#contact">Contact</a>
    <a href="actualites.html" class="active">Actualit√©s</a>
    <a href="Tarifs%20Chambres%20d'h%C3%B4tes%20et%20G%C3%AEte%20-%20Les%20Forges%20d'Enfalits.html" class="nav-cta">Tarifs & R√©servation</a>
  </nav>
</header>

<div class="page-hero">
  <div class="page-hero-content">
    <div class="page-hero-eyebrow">Ari√®ge ¬∑ Pyr√©n√©es ¬∑ Autour de vous</div>
    <h1>Agenda & Sorties</h1>
    <p>√âv√©nements, march√©s et activit√©s du coin ‚Äî mis √† jour automatiquement</p>
  </div>
</div>

<div class="main-content">
  <div class="filters-bar">
    <span class="filter-label">Filtrer :</span>
    <button class="filter-btn active" data-cat="all">Tout voir</button>
    <button class="filter-btn" data-cat="fete">üéâ F√™tes & Festivals</button>
    <button class="filter-btn" data-cat="marche">üõí March√©s</button>
    <button class="filter-btn" data-cat="nature">ü•æ Nature & Rando</button>
    <button class="filter-btn" data-cat="culture">üé≠ Culture</button>
    <button class="filter-btn" data-cat="sport">üöµ Sport</button>
    <button class="filter-btn" data-cat="gastronomie">üç∑ Gastronomie</button>
  </div>

  <div class="loading-state visible" id="loadingState">
    <div class="loading-spinner"></div>
    <div class="loading-text">Recherche des √©v√©nements en Ari√®ge‚Ä¶</div>
    <div class="loading-sub">Mise √† jour automatique en cours</div>
  </div>

  <div id="eventsContainer" style="display:none">
    <div class="events-header">
      <span class="events-count" id="eventsCount"></span>
      <button class="refresh-btn" id="refreshBtn"><span class="refresh-icon">‚Üª</span> Actualiser</button>
    </div>
    <div class="events-grid" id="eventsGrid"></div>
    <div class="last-updated" id="lastUpdated"></div>
  </div>

  <div class="section-links">
    <h2>Sites utiles pour pr√©parer votre s√©jour</h2>
    <p class="sub">Sources officielles de tourisme autour des Forges d'Enfalits</p>
    <div class="links-grid">
      <a href="https://www.ariegepyrenees.com/fr/preparer/agenda/tout-lagenda/" target="_blank" class="link-card">
        <span class="link-icon">üèîÔ∏è</span>
        <div class="link-info"><h4>Ari√®ge Pyr√©n√©es Tourisme</h4><p>Agenda officiel du d√©partement</p></div>
      </a>
      <a href="https://www.foix-tourisme.com/fr/agenda/" target="_blank" class="link-card">
        <span class="link-icon">üè∞</span>
        <div class="link-info"><h4>Office de Tourisme Foix</h4><p>√âv√©nements √† Foix et alentours</p></div>
      </a>
      <a href="https://ariege.demosphere.net/" target="_blank" class="link-card">
        <span class="link-icon">üìÖ</span>
        <div class="link-info"><h4>D√©mosph√®re Ari√®ge</h4><p>Agenda associatif et participatif</p></div>
      </a>
      <a href="https://www.pyrenees-ariegeoises.com/sortir/agenda/" target="_blank" class="link-card">
        <span class="link-icon">üåø</span>
        <div class="link-info"><h4>Pyr√©n√©es Ari√©geoises</h4><p>Parc naturel r√©gional</p></div>
      </a>
      <a href="https://www.grotte-niaux.fr/" target="_blank" class="link-card">
        <span class="link-icon">ü¶¨</span>
        <div class="link-info"><h4>Grotte de Niaux</h4><p>Art rupestre pr√©historique (8 km)</p></div>
      </a>
      <a href="https://www.sites-touristiques-ariege.fr/" target="_blank" class="link-card">
        <span class="link-icon">üó∫Ô∏è</span>
        <div class="link-info"><h4>Sites Touristiques Ari√®ge</h4><p>Ch√¢teaux cathares, grottes, nature</p></div>
      </a>
    </div>
  </div>
</div>

<footer>
  <div class="footer-bottom">
    <a href="index.html" class="footer-back">‚Üê Retour au site des Forges d'Enfalits</a>
    <span>¬© Les Forges d'Enfalits ¬∑ Rabat-les-Trois-Seigneurs ¬∑ Ari√®ge</span>
    <span>Google 4,9/5 ¬∑ Tripadvisor 4,9/5</span>
  </div>
</footer>

<script>
const STATIC_EVENTS = [
  { title:"Randonn√©e ‚Äì Pic des Trois Seigneurs", day:"‚àû", month:"", category:"nature", location:"Rabat-les-Trois-Seigneurs (d√©part aux Forges)", desc:"Depuis les Forges d'Enfalits, mont√©e au Pic des Trois Seigneurs (2199 m). Vue panoramique exceptionnelle sur les Pyr√©n√©es. Comptez 5h A/R, niveau interm√©diaire.", distance:"Au pied", featured:true, link:"https://www.ariegepyrenees.com" },
  { title:"March√© de Tarascon-sur-Ari√®ge", day:"LUN", month:"", category:"marche", location:"Tarascon-sur-Ari√®ge (5 km)", desc:"March√© hebdomadaire du lundi avec producteurs locaux, fromages pyr√©n√©ens, charcuteries, l√©gumes de saison et artisanat ari√©geois.", distance:"5 km", featured:false, link:"https://www.ariegepyrenees.com" },
  { title:"March√© de Foix", day:"VEN", month:"SAM", category:"marche", location:"Foix (15 km)", desc:"Grand march√© traditionnel du vendredi matin sous les arcades m√©di√©vales de Foix. Produits r√©gionaux, fleurs, v√™tements.", distance:"15 km", featured:false, link:"https://www.foix-tourisme.com" },
  { title:"Grotte de Niaux", day:"365", month:"", category:"culture", location:"Niaux (8 km)", desc:"L'une des plus belles grottes orn√©es du monde avec ses peintures rupestres magdal√©niennes vieilles de 14 000 ans. R√©servation obligatoire.", distance:"8 km", featured:false, link:"https://www.grotte-niaux.fr" },
  { title:"Parc de la Pr√©histoire", day:"AVR", month:"‚ÜíNOV", category:"culture", location:"Tarascon-sur-Ari√®ge (5 km)", desc:"Parcours immersif dans la pr√©histoire ari√©geoise. Fresque g√©ante, animations. Id√©al en famille.", distance:"5 km", featured:false, link:"https://www.sites-touristiques-ariege.fr" },
  { title:"P√™che √† la truite ‚Äì Rivi√®re 1√®re cat√©gorie", day:"MAR", month:"‚ÜíSEP", category:"nature", location:"Rivi√®re des Forges d'Enfalits", desc:"La rivi√®re qui borde notre propri√©t√© est une rivi√®re de 1√®re cat√©gorie id√©ale pour la p√™che √† la truite. H√©bergement P√™che agr√©√©.", distance:"Sur place", featured:false, link:"https://www.ariegepyrenees.com" },
  { title:"Cano√´-Kayak sur l'Ari√®ge", day:"JUN", month:"‚ÜíSEP", category:"sport", location:"Tarascon-sur-Ari√®ge (5 km)", desc:"Descente de l'Ari√®ge en cano√´ ou kayak. Plusieurs bases de loisirs proposent location et accompagnement pour tous niveaux.", distance:"5 km", featured:false, link:"https://www.ariegepyrenees.com" },
  { title:"Ax-les-Thermes ‚Äì Bains", day:"365", month:"", category:"nature", location:"Ax-les-Thermes (25 km)", desc:"Station thermale avec bassins gratuits en plein air. Eaux sulfureuses √† 78¬∞C, parfaites apr√®s une randonn√©e.", distance:"25 km", featured:false, link:"https://www.ariegepyrenees.com" },
  { title:"Ch√¢teau de Foix", day:"365", month:"", category:"culture", location:"Foix (15 km)", desc:"Forteresse m√©di√©vale cathare perch√©e sur son rocher. Exposition sur les Comtes de Foix. Vue imprenable sur la vall√©e.", distance:"15 km", featured:false, link:"https://www.sites-touristiques-ariege.fr" },
  { title:"Via Ferrata de Celles", day:"MAI", month:"‚ÜíOCT", category:"sport", location:"Celles (20 km)", desc:"Parcours de via ferrata pour toute la famille et version sportive pour les plus aguerris. Encadrement possible.", distance:"20 km", featured:false, link:"https://www.ariegepyrenees.com" },
  { title:"March√©s Gourmands Estivaux", day:"√âT√â", month:"", category:"gastronomie", location:"Tarascon & villages (5‚Äì15 km)", desc:"March√©s nocturnes tout l'√©t√© avec fromages, charcuteries, vins, miel et confits ari√©geois directement chez les producteurs.", distance:"5‚Äì15 km", featured:false, link:"https://www.ariegepyrenees.com" },
  { title:"F√™te de l'Ours", day:"F√âV", month:"", category:"fete", location:"Saint-Girons & vall√©es (35 km)", desc:"Tradition pyr√©n√©enne ancestrale : l'ours sort de sa tani√®re et parcourt les villages. F√™te populaire color√©e et festive.", distance:"35 km", featured:false, link:"https://www.ariegepyrenees.com" }
];

const CATS = {
  fete:{ label:'F√™te & Festival', css:'cat-fete' },
  marche:{ label:'March√©', css:'cat-marche' },
  nature:{ label:'Nature & Rando', css:'cat-nature' },
  culture:{ label:'Culture & Patrimoine', css:'cat-culture' },
  sport:{ label:'Sport & Aventure', css:'cat-sport' },
  gastronomie:{ label:'Gastronomie', css:'cat-gastronomie' },
  autre:{ label:'Autre', css:'cat-autre' }
};

function renderCard(ev) {
  const cat = CATS[ev.category] || CATS.autre;
  if (ev.featured) {
    return `<div class="event-card featured" data-cat="${ev.category}">
      <span class="featured-badge">‚≠ê Incontournable</span>
      <div class="event-card-top">
        <div class="event-date-box">
          <div class="event-date-day">${ev.day}</div>
          <div class="event-date-month">${ev.month||''}</div>
        </div>
        <div class="event-meta">
          <span class="event-category ${cat.css}">${cat.label}</span>
          <div class="event-title">${ev.title}</div>
          <div class="event-location">${ev.location}</div>
        </div>
      </div>
      <div class="event-card-body"><div class="event-desc">${ev.desc}</div></div>
      <div class="event-card-footer">
        <div class="event-distance">${ev.distance?'üìç '+ev.distance:''}</div>
        <a href="${ev.link||'#'}" target="_blank" class="event-link">En savoir + ‚Üí</a>
      </div>
    </div>`;
  }
  return `<div class="event-card" data-cat="${ev.category}">
    <div class="event-card-top">
      <div class="event-date-box">
        <div class="event-date-day">${ev.day}</div>
        <div class="event-date-month">${ev.month||''}</div>
      </div>
      <div class="event-meta">
        <span class="event-category ${cat.css}">${cat.label}</span>
        <div class="event-title">${ev.title}</div>
      </div>
    </div>
    <div class="event-card-body">
      <div class="event-location">${ev.location}</div>
      <div class="event-desc">${ev.desc}</div>
    </div>
    <div class="event-card-footer">
      <div class="event-distance">${ev.distance?'üìç '+ev.distance:''}</div>
      <a href="${ev.link||'#'}" target="_blank" class="event-link">Voir ‚Üí</a>
    </div>
  </div>`;
}

async function fetchDynamicEvents() {
  try {
    const dateStr = new Date().toLocaleDateString('fr-FR',{day:'numeric',month:'long',year:'numeric'});
    const res = await fetch("https://api.anthropic.com/v1/messages", {
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body: JSON.stringify({
        model:"claude-sonnet-4-20250514",
        max_tokens:1500,
        tools:[{type:"web_search_20250305",name:"web_search"}],
        system:`R√©ponds UNIQUEMENT avec un tableau JSON valide, sans texte avant ou apr√®s, sans balises markdown.
Format exact: {"title":"...","day":"JJ ou abr√©v","month":"MMM ou vide","category":"fete|marche|nature|culture|sport|gastronomie","location":"Ville (X km)","desc":"2-3 phrases.","distance":"X km","featured":false,"link":"https://..."}`,
        messages:[{role:"user",content:`Nous sommes le ${dateStr}. Cherche 4 √† 5 √©v√©nements r√©els actuels ou pr√©vus dans le prochain mois en Ari√®ge (09), autour de Tarascon-sur-Ari√®ge. Retourne un tableau JSON.`}]
      })
    });
    const data = await res.json();
    const txt = (data.content||[]).filter(b=>b.type==='text').map(b=>b.text).join('');
    const m = txt.match(/\[[\s\S]*?\]/);
    return m ? JSON.parse(m[0]) : [];
  } catch(e) { return []; }
}

let currentFilter = 'all';
function applyFilter(cat) {
  currentFilter = cat;
  const cards = document.querySelectorAll('.event-card');
  let visible = 0;
  cards.forEach(c => {
    const show = cat==='all' || c.dataset.cat===cat;
    c.style.display = show ? '' : 'none';
    if (show) visible++;
  });
  document.getElementById('eventsCount').textContent = `${visible} √©v√©nement${visible>1?'s':''} affich√©${visible>1?'s':''}`;
}

document.querySelectorAll('.filter-btn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    applyFilter(btn.dataset.cat);
  });
});

async function loadEvents() {
  document.getElementById('loadingState').classList.add('visible');
  document.getElementById('eventsContainer').style.display = 'none';
  const dynamic = await fetchDynamicEvents();
  const all = [...dynamic, ...STATIC_EVENTS];
  document.getElementById('eventsGrid').innerHTML = all.map(renderCard).join('');
  document.getElementById('eventsCount').textContent = `${all.length} √©v√©nements affich√©s`;
  const now = new Date();
  document.getElementById('lastUpdated').textContent = `Mis √† jour le ${now.toLocaleDateString('fr-FR',{weekday:'long',day:'numeric',month:'long'})} √† ${now.toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'})}`;
  document.getElementById('loadingState').classList.remove('visible');
  document.getElementById('eventsContainer').style.display = 'block';
  applyFilter(currentFilter);
}

document.getElementById('refreshBtn').addEventListener('click', loadEvents);
window.addEventListener('scroll', () => {
  document.getElementById('header').classList.toggle('scrolled', window.scrollY > 60);
});
loadEvents();
</script>
</body>
</html>
